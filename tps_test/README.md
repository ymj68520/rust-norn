# TPS æ€§èƒ½æµ‹è¯•å·¥å…·

è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯• rust-norn åŒºå—é“¾ TPSï¼ˆæ¯ç§’äº¤æ˜“æ•°ï¼‰æ€§èƒ½çš„å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **å®æ—¶ç›‘æ§**: å®æ—¶æ˜¾ç¤ºäº¤æ˜“å‘é€è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ¯ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰ç›®æ ‡ TPSã€æµ‹è¯•æ—¶é•¿ã€æ‰¹æ¬¡å¤§å°ç­‰å‚æ•°
- ğŸ“ˆ **è¯¦ç»†æŠ¥å‘Š**: æä¾›å®Œæ•´çš„æ€§èƒ½åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬å®é™… TPSã€æˆåŠŸç‡ã€è¾¾æˆç‡ç­‰
- â›“ï¸ **åŒºå—é“¾ç›‘æ§**: è‡ªåŠ¨ç›‘æ§åŒºå—é“¾æ‰“åŒ…æƒ…å†µï¼Œè®¡ç®—çœŸå®çš„é“¾ä¸Š TPS

## ç¼–è¯‘

```bash
# ç¼–è¯‘ release ç‰ˆæœ¬
cargo build -p tps_test --release

# æˆ–ä½¿ç”¨ Makefile
make build
```

ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº: `./target/release/tps_test`

## å‰ç½®æ¡ä»¶

åœ¨è¿è¡Œ TPS æµ‹è¯•ä¹‹å‰ï¼Œéœ€è¦å…ˆå¯åŠ¨è‡³å°‘ä¸€ä¸ª norn èŠ‚ç‚¹ï¼š

### æ–¹å¼ 1: ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
cd docker
./start-nodes.sh
```

è¿™å°†å¯åŠ¨ 3 ä¸ªèŠ‚ç‚¹ï¼ŒRPC ç«¯å£åˆ†åˆ«ä¸º 50051ã€50052ã€50053ã€‚

### æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨èŠ‚ç‚¹

```bash
# ç»ˆç«¯ 1: å¯åŠ¨èŠ‚ç‚¹ 1
./target/release/norn --config node1_config.toml

# ç»ˆç«¯ 2: å¯åŠ¨èŠ‚ç‚¹ 2ï¼ˆå¯é€‰ï¼Œç”¨äºå¤šèŠ‚ç‚¹æµ‹è¯•ï¼‰
./target/release/norn --config node2_config.toml
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

ä½¿ç”¨é»˜è®¤é…ç½®æµ‹è¯•ï¼ˆç›®æ ‡ TPS: 100ï¼Œæµ‹è¯•æ—¶é•¿: 60 ç§’ï¼‰ï¼š

```bash
./target/release/tps_test
```

### è‡ªå®šä¹‰å‚æ•°

```bash
# ç›®æ ‡ 500 TPSï¼Œæµ‹è¯• 120 ç§’
./target/release/tps_test --rate 500 --duration 120

# æŒ‡å®š RPC åœ°å€å’Œæ›´é«˜çš„æ‰¹æ¬¡å¤§å°
./target/release/tps_test --rpc-address 127.0.0.1:50051 --rate 1000 --batch-size 50

# å®Œæ•´å‚æ•°ç¤ºä¾‹
./target/release/tps_test \
  --rpc-address 127.0.0.1:50051 \
  --duration 300 \
  --rate 500 \
  --batch-size 20 \
  --monitor-interval 10
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--rpc-address` | `-a` | `127.0.0.1:50051` | RPC æœåŠ¡å™¨åœ°å€ |
| `--duration` | `-d` | `60` | æµ‹è¯•æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ |
| `--rate` | `-r` | `100` | ç›®æ ‡ TPSï¼ˆæ¯ç§’äº¤æ˜“æ•°ï¼‰ |
| `--concurrent` | `-c` | `10` | å¹¶å‘è¿æ¥æ•°ï¼ˆé¢„ç•™å‚æ•°ï¼‰ |
| `--batch-size` | `-b` | `10` | æ¯æ‰¹äº¤æ˜“æ•°é‡ |
| `--monitor-interval` | `-i` | `5` | ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ |

## æµ‹è¯•æµç¨‹

1. **è¿æ¥é˜¶æ®µ**: è¿æ¥åˆ°æŒ‡å®šçš„ RPC æœåŠ¡å™¨
2. **åŸºçº¿è®°å½•**: è®°å½•å½“å‰åŒºå—é«˜åº¦ä½œä¸ºåŸºçº¿
3. **äº¤æ˜“å‘é€**: ä»¥æŒ‡å®šé€Ÿç‡å‘é€äº¤æ˜“åˆ°èŠ‚ç‚¹
4. **å®æ—¶ç›‘æ§**: å®šæœŸæ˜¾ç¤ºå‘é€è¿›åº¦å’Œå½“å‰é€Ÿç‡
5. **ç­‰å¾…æ‰“åŒ…**: ç­‰å¾… 30 ç§’è®©æ‰€æœ‰äº¤æ˜“è¢«æ‰“åŒ…åˆ°åŒºå—é“¾
6. **åŒºå—é“¾ç›‘æ§**: æ‰«ææ–°åŒºå—ï¼Œç»Ÿè®¡å®é™…æ‰“åŒ…çš„äº¤æ˜“æ•°
7. **æŠ¥å‘Šç”Ÿæˆ**: æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Š

## è¾“å‡ºç¤ºä¾‹

```
ğŸš€ å¯åŠ¨ TPS æ€§èƒ½æµ‹è¯•
=======================
RPC åœ°å€: 127.0.0.1:50051
æµ‹è¯•æŒç»­æ—¶é—´: 60 ç§’
ç›®æ ‡ TPS: 100
å¹¶å‘è¿æ¥æ•°: 10
æ‰¹æ¬¡å¤§å°: 10
ç›‘æ§é—´éš”: 5 ç§’
=======================

ğŸ“¡ è¿æ¥åˆ° RPC æœåŠ¡å™¨: 127.0.0.1:50051
âœ… æˆåŠŸè¿æ¥åˆ° RPC æœåŠ¡å™¨
ğŸ“Š å½“å‰åŒºå—é«˜åº¦: 0

ğŸ¯ å¼€å§‹å‘é€äº¤æ˜“ï¼ˆç›®æ ‡ TPS: 100ï¼‰
â±ï¸  æ‰¹æ¬¡é—´éš”: 100ms
ğŸ“¦ å·²å‘é€ 1000 ç¬”äº¤æ˜“
ğŸ“¦ å·²å‘é€ 2000 ç¬”äº¤æ˜“
...
âœ… äº¤æ˜“å‘é€å®Œæˆ!
   æ€»å‘é€: 6000 ç¬”äº¤æ˜“
   å‘é€è€—æ—¶: 60.01s
   å‘é€é€Ÿç‡: 99.98 TPS

â³ ç­‰å¾…äº¤æ˜“æ‰“åŒ…ï¼ˆ30ç§’ï¼‰...
ğŸ” å¼€å§‹ç›‘æ§åŒºå—é“¾æ‰“åŒ…æƒ…å†µ...
ğŸ“Š å½“å‰åŒºå—é«˜åº¦: 120
   å·²å¤„ç† 120 ä¸ªåŒºå—ï¼Œå…± 6000 ç¬”äº¤æ˜“

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    TPS æµ‹è¯•æŠ¥å‘Š                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š æµ‹è¯•é…ç½®:
   â”œâ”€ ç›®æ ‡ TPS: 100
   â”œâ”€ èµ·å§‹åŒºå—: 0
   â””â”€ æµ‹è¯•æ—¶é•¿: 60.01 ç§’

ğŸ“¦ äº¤æ˜“æäº¤ç»Ÿè®¡:
   â”œâ”€ å·²æäº¤: 6000 ç¬”
   â”œâ”€ å¤±è´¥: 0 ç¬”
   â”œâ”€ æˆåŠŸç‡: 100.00%
   â””â”€ æäº¤é€Ÿç‡: 99.98 TPS

â›“ï¸  åŒºå—é“¾æ‰“åŒ…ç»Ÿè®¡:
   â”œâ”€ æ‰“åŒ…äº¤æ˜“: 6000 ç¬”
   â”œâ”€ äº§ç”ŸåŒºå—: 120 ä¸ª
   â”œâ”€ å®é™… TPS: 100.00
   â”œâ”€ è¾¾æˆç‡: 100.00%
   â””â”€ å¹³å‡æ¯å—äº¤æ˜“: 50.00

ğŸ“ˆ æ€§èƒ½åˆ†æ:
   âœ… ä¼˜ç§€: TPS è¾¾æˆç‡ 100.00% >= 90%
   âœ… ä¼˜ç§€: äº¤æ˜“æˆåŠŸç‡ 100.00% >= 99%
   ğŸ“Š äº¤æ˜“æ‰“åŒ…ç‡: 100.00%

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        æµ‹è¯•å®Œæˆ                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## æ€§èƒ½æŒ‡æ ‡è¯´æ˜

### äº¤æ˜“æäº¤ç»Ÿè®¡
- **å·²æäº¤**: æˆåŠŸå‘é€åˆ°èŠ‚ç‚¹çš„äº¤æ˜“æ•°
- **å¤±è´¥**: å‘é€å¤±è´¥çš„äº¤æ˜“æ•°
- **æˆåŠŸç‡**: (å·²æäº¤ / (å·²æäº¤ + å¤±è´¥)) Ã— 100%
- **æäº¤é€Ÿç‡**: å¹³å‡æ¯ç§’æäº¤çš„äº¤æ˜“æ•°

### åŒºå—é“¾æ‰“åŒ…ç»Ÿè®¡
- **æ‰“åŒ…äº¤æ˜“**: å®é™…è¢«æ‰“åŒ…åˆ°åŒºå—é“¾çš„äº¤æ˜“æ•°
- **äº§ç”ŸåŒºå—**: æµ‹è¯•æœŸé—´äº§ç”Ÿçš„æ–°åŒºå—æ•°
- **å®é™… TPS**: åŒºå—é“¾å®é™…å¤„ç†çš„ TPS = æ‰“åŒ…äº¤æ˜“ / æ—¶é—´è·¨åº¦
- **è¾¾æˆç‡**: (å®é™… TPS / ç›®æ ‡ TPS) Ã— 100%
- **å¹³å‡æ¯å—äº¤æ˜“**: æ‰“åŒ…äº¤æ˜“ / äº§ç”ŸåŒºå—

### æ€§èƒ½è¯„çº§
- **ä¼˜ç§€**: TPS è¾¾æˆç‡ >= 90%ï¼Œäº¤æ˜“æˆåŠŸç‡ >= 99%
- **è‰¯å¥½**: TPS è¾¾æˆç‡ >= 70%ï¼Œäº¤æ˜“æˆåŠŸç‡ >= 95%
- **ä¸€èˆ¬**: TPS è¾¾æˆç‡ >= 50%
- **éœ€è¦ä¼˜åŒ–**: ä½äºä»¥ä¸Šæ ‡å‡†

## æµ‹è¯•åœºæ™¯å»ºè®®

### åœºæ™¯ 1: åŸºå‡†æ€§èƒ½æµ‹è¯•
```bash
# æµ‹è¯•ç³»ç»Ÿçš„åŸºæœ¬ TPS æ€§èƒ½
./target/release/tps_test --rate 100 --duration 60
```

### åœºæ™¯ 2: å‹åŠ›æµ‹è¯•
```bash
# æµ‹è¯•ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„è¡¨ç°
./target/release/tps_test --rate 1000 --duration 300 --batch-size 50
```

### åœºæ™¯ 3: ç¨³å®šæ€§æµ‹è¯•
```bash
# é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ç³»ç»Ÿç¨³å®šæ€§
./target/release/tps_test --rate 500 --duration 600
```

### åœºæ™¯ 4: å¤šèŠ‚ç‚¹æµ‹è¯•
```bash
# åˆ†åˆ«æµ‹è¯•ä¸åŒçš„èŠ‚ç‚¹
./target/release/tps_test --rpc-address 127.0.0.1:50051 --rate 200
./target/release/tps_test --rpc-address 127.0.0.1:50052 --rate 200
./target/release/tps_test --rpc-address 127.0.0.1:50053 --rate 200
```

## å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•æ˜¾ç¤º "Failed to connect to RPC server"
**A**: ç¡®ä¿èŠ‚ç‚¹æ­£åœ¨è¿è¡Œå¹¶ä¸” RPC ç«¯å£æ­£ç¡®ã€‚æ£€æŸ¥èŠ‚ç‚¹æ—¥å¿—ç¡®è®¤ RPC æœåŠ¡å·²å¯åŠ¨ã€‚

### Q2: å®é™… TPS è¿œä½äºç›®æ ‡ TPS
**A**: å¯èƒ½çš„åŸå› ï¼š
- èŠ‚ç‚¹å¤„ç†èƒ½åŠ›è¾¾åˆ°ç“¶é¢ˆ
- å…±è¯†æœºåˆ¶é™åˆ¶äº†åŒºå—ç”Ÿæˆé€Ÿåº¦
- ç½‘ç»œå»¶è¿Ÿæˆ–å¸¦å®½é™åˆ¶
- äº¤æ˜“éªŒè¯è€—æ—¶è¾ƒé•¿

### Q3: äº¤æ˜“æ‰“åŒ…ç‡å¾ˆä½
**A**: å¯èƒ½çš„åŸå› ï¼š
- å…±è¯†æœºåˆ¶æœªæ­£ç¡®æ‰“åŒ…äº¤æ˜“
- äº¤æ˜“æ± å·²æ»¡
- äº¤æ˜“éªŒè¯å¤±è´¥
- ç­‰å¾…æ—¶é—´ä¸å¤Ÿï¼ˆå¢åŠ ç­‰å¾…æ—¶é—´ï¼‰

### Q4: å¦‚ä½•æé«˜æµ‹è¯•å‡†ç¡®æ€§ï¼Ÿ
**A**:
- å¢åŠ æµ‹è¯•æ—¶é•¿ï¼ˆè‡³å°‘ 60 ç§’ï¼‰
- å¢åŠ ç­‰å¾…æ‰“åŒ…çš„æ—¶é—´ï¼ˆä¿®æ”¹ä»£ç ä¸­çš„ 30 ç§’ï¼‰
- å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼
- ç¡®ä¿èŠ‚ç‚¹èµ„æºå……è¶³ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰

## æ¶æ„è¯´æ˜

### æ¨¡å—ç»„æˆ

```
tps_test/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                  # ä¸»æµ‹è¯•è¿è¡Œå™¨
â”‚   â”œâ”€â”€ transaction_generator.rs # äº¤æ˜“ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ rpc_client.rs           # gRPC å®¢æˆ·ç«¯
â”‚   â””â”€â”€ statistics.rs           # ç»Ÿè®¡æ¨¡å—
â”œâ”€â”€ build.rs                     # Protobuf ç¼–è¯‘
â”œâ”€â”€ Cargo.toml                   # é¡¹ç›®é…ç½®
â””â”€â”€ README.md                    # æœ¬æ–‡ä»¶
```

### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®å‚æ•°è§£æ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥ RPC æœåŠ¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®°å½•åŸºçº¿åŒºå—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é€æµ‹è¯•äº¤æ˜“   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  å®æ—¶è¿›åº¦ç›‘æ§   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â–¼                   â”‚
    æµ‹è¯•æ—¶é•¿ç»“æŸ              â”‚
         â”‚                   â”‚
         â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  ç­‰å¾…äº¤æ˜“æ‰“åŒ…   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  ç›‘æ§åŒºå—é“¾     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                             â”‚
    æœªè¾¾åˆ°æµ‹è¯•æ—¶é•¿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¼€å‘å’Œè´¡çŒ®

### è¿è¡Œå•å…ƒæµ‹è¯•

```bash
cargo test -p tps_test
```

### ä»£ç æ ¼å¼åŒ–

```bash
cargo fmt -p tps_test
```

### ä»£ç æ£€æŸ¥

```bash
cargo clippy -p tps_test
```

## è®¸å¯è¯

ä¸ rust-norn é¡¹ç›®ä¿æŒä¸€è‡´ã€‚
